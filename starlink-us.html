<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Mapbox GL JS - Starlink Cities and AWS Regions</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    // Mapbox access token
    mapboxgl.accessToken = 'pk.eyJ1IjoiczhtYXRodXIiLCJhIjoiY2xzbHl1Zjg0MGZpdjJrcGVpa2pkbG0wNiJ9.rFDdt45Wd4s6a-RfqvAQiQ';

    // Initialize the map
    const map = new mapboxgl.Map({
        container: 'map', // ID of the container
        style: 'mapbox://styles/mapbox/streets-v12', // Map style
        center: [-98.5795, 39.8283], // Center on USA
        zoom: 4 // Initial zoom level
    });

    // GeoJSON for Starlink IP-based cities in the USA
    const starlinkCitiesGeoJSON = {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "geometry": { "type": "Point", "coordinates": [-74.006, 40.7128] },
                "properties": { "city": "New York", "state": "New York" }
            },
            {
                "type": "Feature",
                "geometry": { "type": "Point", "coordinates": [-118.2437, 34.0522] },
                "properties": { "city": "Los Angeles", "state": "California" }
            },
            {
                "type": "Feature",
                "geometry": { "type": "Point", "coordinates": [-87.6298, 41.8781] },
                "properties": { "city": "Chicago", "state": "Illinois" }
            }
        ]
    };

    // GeoJSON for AWS regions in the USA
    const awsRegionsGeoJSON = {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "geometry": { "type": "Point", "coordinates": [-122.3321, 47.6062] },
                "properties": { "region": "us-west-2", "name": "Oregon" }
            },
            {
                "type": "Feature",
                "geometry": { "type": "Point", "coordinates": [-97.7431, 30.2672] },
                "properties": { "region": "us-west-1", "name": "California" }
            },
            {
                "type": "Feature",
                "geometry": { "type": "Point", "coordinates": [-77.0369, 38.9072] },
                "properties": { "region": "us-east-1", "name": "Virginia" }
            }
        ]
    };

    map.on('load', () => {
        // Add Starlink Cities layer
        map.addSource('starlink-cities', {
            type: 'geojson',
            data: starlinkCitiesGeoJSON
        });

        map.addLayer({
            id: 'starlink-cities-layer',
            type: 'circle',
            source: 'starlink-cities',
            paint: {
                'circle-radius': 8,
                'circle-color': '#FF4500',
                'circle-stroke-color': '#FFFFFF',
                'circle-stroke-width': 2
            }
        });

        // Add AWS Regions layer
        map.addSource('aws-regions', {
            type: 'geojson',
            data: awsRegionsGeoJSON
        });

        map.addLayer({
            id: 'aws-regions-layer',
            type: 'circle',
            source: 'aws-regions',
            paint: {
                'circle-radius': 8,
                'circle-color': '#1E90FF',
                'circle-stroke-color': '#FFFFFF',
                'circle-stroke-width': 2
            }
        });

        // Add popups for Starlink Cities
        map.on('click', 'starlink-cities-layer', (e) => {
            const coordinates = e.features[0].geometry.coordinates.slice();
            const { city, state } = e.features[0].properties;

            new mapboxgl.Popup()
                .setLngLat(coordinates)
                .setHTML(`<strong>${city}, ${state}</strong>`)
                .addTo(map);
        });

        // Add popups for AWS Regions
        map.on('click', 'aws-regions-layer', (e) => {
            const coordinates = e.features[0].geometry.coordinates.slice();
            const { region, name } = e.features[0].properties;

            new mapboxgl.Popup()
                .setLngLat(coordinates)
                .setHTML(`<strong>${name} (${region})</strong>`)
                .addTo(map);
        });

        // Change the cursor to a pointer when hovering over layers
        map.on('mouseenter', 'starlink-cities-layer', () => {
            map.getCanvas().style.cursor = 'pointer';
        });
        map.on('mouseleave', 'starlink-cities-layer', () => {
            map.getCanvas().style.cursor = '';
        });

        map.on('mouseenter', 'aws-regions-layer', () => {
            map.getCanvas().style.cursor = 'pointer';
        });
        map.on('mouseleave', 'aws-regions-layer', () => {
            map.getCanvas().style.cursor = '';
        });
    });
</script>
</body>
</html>